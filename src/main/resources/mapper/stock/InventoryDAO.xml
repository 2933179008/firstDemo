<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.tbl.modules.stock.dao.InventoryDAO">
    <select id="getAllListI" resultType="com.tbl.modules.stock.entity.Inventory">
        select id,inventory_task_id,inventory_code,inventory_user_id,
        inventory_time,state,remark,create_time,create_by
        from inventory where 1=1
        <if test="list!=null and list.size()>0">
            and id in
            <foreach item="ids" index="index" collection="list"
                     open="(" separator="," close=")">
                #{ids}
            </foreach>
        </if>
    </select>

    <!--根据id更新状态-->
    <update id="updateState">
        update inventory set state = '1' where id=#{id}
    </update>

    <select id="selectListS" resultType="com.tbl.modules.stock.entity.InventoryDetail">
        SELECT    a.position_code,a.rfid,a.material_code,a.material_name,a.inventory_amount,a.id, c.barcode  AS barcode
        FROM inventory_detail a
        INNER JOIN inventory  b ON b.id=a.inventory_id
        INNER JOIN base_materiel c ON c.materiel_code=a.material_code
        WHERE b.id =#{id}
    </select>

    <select id="getMaxInventoryCode" resultType="java.lang.String">
        select max(inventory_code) from inventory
    </select>

    <!--&lt;!&ndash;获取库存下拉列表&ndash;&gt;-->
    <!--<select id="getSelectPositionList" resultType="java.util.Map">-->
        <!--select position_code as id,position_code as text from inventory_task group by position_code having count(position_code)>= 1-->
        <!--<if test='queryString!=null and queryString!=""'>-->
            <!--and position_code like concat(concat('%', #{queryString}), '%')-->
        <!--</if>-->
    <!--</select>-->

    <!--&lt;!&ndash;获取库存下拉列表总条数&ndash;&gt;-->
    <!--<select id="getSelectPositionTotal" resultType="java.lang.Integer">-->
        <!--select count(1) from inventory_task where inventory_task_id=#{inventoryTaskId}-->
        <!--<if test='queryString!=null and queryString!=""'>-->
            <!--and position_code like concat(concat('%', #{queryString}), '%')-->
        <!--</if>-->
    <!--</select>-->

    <!--获取库存下拉列表-->
    <select id="getSelectPositionList" resultType="java.util.Map">
        select DISTINCT position_code as id,position_code as text
        from inventory_task_detail
        where 1=1
        and inventory_task_id=#{inventoryTaskId}
        <if test='queryString!=null and queryString!=""'>
            and position_code like concat(concat('%', #{queryString}), '%')
        </if>
    </select>

    <!--获取库存下拉列表总条数-->
    <select id="getSelectPositionTotal" resultType="java.lang.Integer">
        select count(DISTINCT position_code)
        from  inventory_task_detail
        where 1=1
        and inventory_task_id=#{inventoryTaskId}
        <if test='queryString!=null and queryString!=""'>
            and position_code like concat(concat('%', #{queryString}), '%')
        </if>
    </select>

    <!--获取物料下拉列表-->
    <select id="getSelectMaterielList" resultType="java.util.Map">
        select DISTINCT material_code as id,material_name as text
        from inventory_task_detail
        where position_code=#{positionCode}
        and inventory_task_id=#{inventoryTaskId}
        <if test='queryString!=null and queryString!=""'>
            and material_name like concat(concat('%', #{queryString}), '%')
        </if>
        and state="0" or state="2"
    </select>

    <!--获取物料下拉列表总条数-->
    <select id="getSelectMaterielTotal" resultType="java.lang.Integer">
        select count(DISTINCT material_code)
        from  inventory_task_detail
        where position_code=#{positionCode}
        and inventory_task_id=#{inventoryTaskId}
        <if test='queryString!=null and queryString!=""'>
            and material_code like concat(concat('%', #{queryString}), '%')
        </if>
        and state="0" or state="2"
    </select>

</mapper>