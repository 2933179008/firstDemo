<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.tbl.modules.handheldInterface.dao.PutBillInterfaceDAO">
    <!--更新上架单的提交状态-->
    <update id="updateState">
        update put_bill set state = '1' where id=#{putBillId}
    </update>

    <select id="getPutBillList" resultType="com.tbl.modules.instorage.entity.PutBill">
        SELECT
        put_bill.id,put_bill_code,instorage_bill_id,put_bill.instorage_bill_code,area_code,area_name,
        operator,operator_name,put_bill.state,put_bill.submit_time,put_bill.create_time,put_bill.update_time,
        put_bill.create_by,instorage_bill.instorage_type,instorage_process
        FROM `put_bill`
        left join instorage_bill
        ON put_bill.instorage_bill_id = instorage_bill.id
        where (put_bill.state =0 and operator IS NULL)
        <if test="userId != null and userId != ''">
            or
            (put_bill.state =0 and operator = #{userId})
            or
            (put_bill.state = 2 and operator = #{userId})
            or
            (put_bill.state = 1 and operator = #{userId})
            ORDER BY put_bill.state DESC
        </if>

    </select>

</mapper>