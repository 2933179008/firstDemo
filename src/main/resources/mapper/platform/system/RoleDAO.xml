<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.tbl.modules.platform.dao.system.RoleDAO">

    <!--获取角色列表数据-->
    <select id="getRoleList" resultType="map">
        select *, ROLE_ID id,ROLE_NAME as text from SYS_ROLE where 1=1
        <if test="dname != null and dname.trim() != ''">
            AND ROLE_NAME like concat(concat('%', #{dname}), '%')
        </if>
    </select>

    <!--获取角色列表数据-->
    <select id="selectRoleListS" resultType="com.tbl.modules.platform.entity.system.Role">
        select *, ROLE_NAME as text from SYS_ROLE where 1=1
        <if test="dname != null and dname.trim() != ''">
            AND ROLE_NAME like concat(concat('%', #{dname}), '%')
        </if>

        <if test="roleName != null and roleName.trim() != ''">
            AND ROLE_NAME like concat(concat('%', #{roleName}), '%')

        </if>
    </select>

    <!--获取角色列表-->
    <select id="getRoles" resultType="map">
        select ROLE_ID id,ROLE_NAME as name from SYS_ROLE where 1=1
    </select>

    <!--根据角色主键获取角色菜单1-->
    <select id="getMenuListByRidOne" resultType="map">
        SELECT menu.MENU_ID id, menu.PARENT_ID as "pId",menu.MENU_NAME as name, FALSE checked, menu.MENU_ORDER
        FROM sys_menu menu where menu.MENU_ID not in
        (select MENU_ID from sys_rolemenu sr where sr.ROLE_ID = #{rid}) union ALL (
        select srm.MENU_ID id,sme.PARENT_ID as "pId",sme.MENU_NAME as name, TRUE checked,sme.MENU_ORDER from sys_rolemenu srm
        inner join sys_menu sme on sme.MENU_ID = srm.MENU_ID
        where srm.ROLE_ID = #{rid}) order by MENU_ORDER
    </select>

    <!--根据角色主键获取角色菜单2-->
    <select id="getMenuListByRidTwo" resultType="map">
        select 0 id,-1 as "pId",'所有菜单' as name,false checked,0 MENU_ORDER union all(
		select menu.MENU_ID id,menu.PARENT_ID as "pId",menu.MENU_NAME as name, false checked,menu.MENU_ORDER
		  from sys_menu menu) order by MENU_ORDER

    </select>

    <!--查询存在用户的角色列表-->
    <select id="isHasRoleUser" resultType="com.tbl.modules.platform.entity.system.Role">
        select * from SYS_ROLE where ROLE_ID in
            ( select ROLE_ID from SYS_USER where ROLE_ID IN
                <foreach collection="list" item="ids" index="index" open="(" separator="," close=")">
                    #{ids}
                </foreach>
            )
    </select>

    <!--查询是否有相同名称的角色-->
    <select id="isHasRoleByName" resultType="int">
          select count(1) from SYS_ROLE where ROLE_NAME = #{roleName}
          <if test="roleId != null and roleId != ''">
              AND  ROLE_ID != #{roleId}
          </if>
    </select>

    <!--更新角色权限-->
    <update id="updateRoleQX">
        update sys_role set ${qxName} = #{qxValue} where role_id = #{roleId};
    </update>

</mapper>