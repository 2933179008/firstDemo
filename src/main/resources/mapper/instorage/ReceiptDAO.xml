<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.tbl.modules.instorage.dao.ReceiptDAO">
    <!--根据收货单id更新收货计划单的状态为待收货-->
    <update id="updateState">
        update receipt_plan set state = '1' where id=#{receiptId}
    </update>
    <!--根据收货单id更新收货计划单的状态为收货中-->
    <update id="updateStateToReceipt">
        update receipt_plan set state = '2' where id=#{receiptPlanId}
    </update>
    <!--根据收货单id更新收货计划单的状态为已完成-->
    <update id="updateStateToComplete">
        update receipt_plan set state = '3' where id=#{receiptPlanId}
    </update>

    <select id="getMaxReceiptCode" resultType="java.lang.String">
        select max(receipt_code) from receipt_plan
    </select>

    <!--获取供应商下拉列表-->
    <select id="getSelectSupplierList" resultType="java.util.Map">
        select supplier_code as id,supplier_name as text from base_supplier where 1=1
        <if test='queryString!=null and queryString!=""'>
            and supplier_name like concat(concat('%', #{queryString}), '%')
        </if>
    </select>

    <!--获取供应商下拉列表总条数-->
    <select id="getSelectSupplierTotal" resultType="java.lang.Integer">
        select count(1) from base_supplier where 1=1
        <if test='queryString!=null and queryString!=""'>
            and supplier_name like concat(concat('%', #{queryString}), '%')
        </if>
    </select>

    <!--获取货主（客户）下拉列表-->
    <select id="getSelectCustomerList" resultType="java.util.Map">
        select customer_code as id,customer_name as text from base_customer where 1=1
        <if test='queryString!=null and queryString!=""'>
            and customer_name like concat(concat('%', #{queryString}), '%')
        </if>
    </select>

    <!--获取货主（客户）下拉列表总条数-->
    <select id="getSelectCustomerTotal" resultType="java.lang.Integer">
        select count(1) from base_customer where 1=1
        <if test='queryString!=null and queryString!=""'>
            and customer_name like concat(concat('%', #{queryString}), '%')
        </if>
    </select>
    <!--根据id获取入库单导出列-->
    <select id="getAllLists" resultType="com.tbl.modules.instorage.entity.Receipt">
        select a.*,b.username createName
        from receipt_plan a
        left join sys_user b on a.create_by=b.user_id
        where 1=1
        <if test="list!=null and list.size()>0">
            and a.id in
            <foreach item="ids" index="index" collection="list"
                     open="(" separator="," close=")">
                #{ids}
            </foreach>
        </if>
    </select>
</mapper>